{% extends 'base.html' %}
{% block page-name %}INDEX{% endblock page-name %}
{% block content %}
{% csrf_token %}

<script type="text/javascript">
    function checkStep(step){
        console.log("come in")

        if (step === "one"){
            alert("멤버 단계 1은 글 읽기만 가능합니다.");
            return false;
        }
        return true;
    }

    function checkSecret(pUser, secret){
        console.log("dkdkdkkd")
        if('{{user.is_superuser}}' === 'True'){
            return true;
        }
        if (secret === "true"){
            if('{{user}}' === pUser ||
                '{{user.is_superuser}}' === 'True' ||
                '{{user.is_staff}}' === 'True'){
                return true;
            }
        }
        alert("이 글은 비밀글입니다. \n 관리자와 작성자만 확인 가능합니다.");
        return false;
    }
</script>

{% if user.is_authenticated %}
<div class="text-center text-2xl text-blue-900 font-bold">Board</div><br><br>
<div class="w-full flex item-center justify-center">
<div class="inline-block px-24 py-10 border-solid border-4 border-gray-800 shadow-2xl ml-128">

<div class="text-blue-900 whitespace-no-wrap text-right">

{% if user.is_staff  or user.is_superuser%}
<div class="text-orange-600 inline font-semibold pr-2">staff</div>
{% else %}

    {% if user.step == "one" %}
    <div class="inline text-purple-500 font-semibold pr-2">step 1</div>

    {% elif  user.step == "two"%}
    <div class="inline text-purple-600 font-semibold pr-2">step 2</div>

    {% else %}
    <div class="inline text-purple-700 font-semibold pr-2">step 3</div>

{% endif %}{% endif %}
 {{ user }}님
<a href={% url 'logout'%}><button class="text-blue-900 hover:text-red-600 font-bold py-2 px-2 rounded-full">Sign Out</a></button>
</div><br>

<ul class="flex border-b">
{% for board in boards %}
  <li class="mr-1">
    <a class="box-border bg-white inline-block py-2 px-4 text-blue-800 hover:text-green-600 font-semibold" href="{% url 'index' board.path %}">{{ board.name }}</a>
  </li>
  {% endfor %}
  {% if user.is_staff or user.is_superuser %}
    <a href="{% url 'new'%}" class="bg-white inline-block py-2 px-4 text-blue-800 hover:text-green-600 font-bold">+</a>
{% endif %}
</ul>


<a href = {% url 'new_post' %} class="text-4xl" 
onclick="return checkStep('{{user.step}}');"><div class="text-right">📝</div></a>
{% csrf_token %}

{% for post in posts %}

{% if post.secret == "true" %}
<div class="border-red-600 border-solid border-2 pl-6 py-2">
<div class="float-left">{{ post.title }}</div>

{% else %}
<div class="border-blue-900 border-solid border-2 pl-6 py-2">
<div class="float-left">{{ post.title }}</div>
{% endif %}

<div class="flex justify-end">
<div class="pr-2">{{ post.user }}</div>

<a href={% url 'detail_post' post.id %} class="text-2xl text-blue-900"
onclick="return checkSecret('{{post.user}}','{{post.secret}}');">
<div class="pr-6">→</div></a></div></div>
<br>
{% endfor %}
<br><br>
</div>
</div>
</div>
{% else%}
<div class="text-center text-2xl text-blue-900 font-bold mb-6">Log In</div><br><br>
<div class="w-full flex item-center justify-center">
<form method="POST" action="{% url 'login' %}" class="inline-block px-32 py-10 border-solid border-4 border-gray-800 text-center shadow-2xl">
{% csrf_token %}
아이디(username):
<br>
<input id="username" name="username" type="text" value=""
class = "bg-white focus:outline-none focus:shadow-outline border border-gray-300 rounded-lg py-2 px-4 block w-full appearance-none leading-normal">
<br>
비밀번호(password):
<br>
<input type="password" id="pwd" name="pwd" value=""
class = "bg-white focus:outline-none focus:shadow-outline border border-gray-300 rounded-lg py-2 px-4 block w-full appearance-none leading-normal">
<br>
<button type="submit" class="bg-blue-900 text-white hover:bg-green-600 font-bold py-2 px-4 rounded-full">Sign In</button>
<button class="text-blue-900 hover:text-green-600 font-bold py-2 px-4 rounded-full"><a href="{% url 'signup'%}">Sign Up</a></button>
</div>
</div></form>
{% if messages %}
<script>
{% for message in messages %}
alert("{{message}}");
{% endfor %}
</script>
{% endif %}

{% endif %}     
{% endblock content %}